-->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© ØµÙˆØª Ø³Ø§Ø±Ø§ÙŠ - Judy Voice Gate - AlArabClub777.com</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0a20 0%, #05030e 100%);
            color: #E0E7FF;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 500px;
            background: #1C2333;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1), 0 0 50px rgba(0, 255, 255, 0.05);
            border: 1px solid #00FFFF33;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 1rem;
            background: #0D1117;
            border: 1px solid #00FFFF55;
            border-radius: 8px;
            color: #E0E7FF;
            resize: none;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #00FFFF;
        }
        .btn-generate {
            background-color: #00FFFF;
            color: #0D1117;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.1s, opacity 0.3s;
        }
        .btn-generate:hover {
            background-color: #00E0E0;
            box-shadow: 0 0 20px #00FFFF55;
        }
        .btn-generate:active {
            transform: scale(0.98);
        }
        .loading-spinner {
            border: 4px solid rgba(0, 255, 255, 0.2);
            border-top: 4px solid #00FFFF;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: none;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message-box {
            background: #2D3748;
            border-left: 4px solid #00FFFF;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        .audio-controls {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #00FFFF33;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-6 text-[#00FFFF]">ğ“‚€ Ø¨ÙˆØ§Ø¨Ø© ØµÙˆØª Ø³Ø§Ø±Ø§ÙŠ ğ“‚€</h1>
        <p class="text-center text-sm mb-6 text-gray-400">Ø­ÙˆÙ‘Ù„ Ù†ØµÙˆØµ Ø§Ù„Ù†Ø¨ÙˆØ¡Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø¥Ù„Ù‰ ØµÙˆØª Ø±ÙˆØ­ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù€ YouTube.</p>

        <div id="statusMessage" class="message-box hidden mb-4 text-sm"></div>

        <div class="mb-4">
            <label for="scriptText" class="block text-sm font-medium mb-2 text-[#00FFFF]">Ù†Øµ Ø§Ù„Ù†Ø¨ÙˆØ¡Ø© (Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰):</label>
            <textarea id="scriptText" placeholder="Ù§Ù§Ù§Ù…Ø«Ø§Ù„: Ù…Ù† Ø¨ÙˆØ§Ø¨Ø© Ø¯Ù†Ø§Ø¯Ø±Ø§ØŒ Ø£Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„ØµØ§Ø¹Ø¯ ÙˆØ§Ù„Ø¨ØªÙƒÙˆÙŠÙ†. Ù„Ø§ ØªØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø±Ø¶ØŒ Ø¨Ù„ Ø¹Ù† Ø§Ù„Ø³Ù…Ø§Ø¡. Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù‡ÙŠØ±ÙˆØºÙ„ÙŠÙÙŠØ© Ù‡ÙŠ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ø±ÙˆØ­ÙŠØŒ ÙˆÙ„ÙŠØ³Øª Ù…Ø¬Ø±Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª." class="text-right" required></textarea>
        </div>

        <button id="generateBtn" class="btn-generate w-full flex items-center justify-center" onclick="generateAndPlayAudio()">
            <div id="spinner" class="loading-spinner"></div>
            <span id="btnText">ØªÙˆÙ„ÙŠØ¯ ÙˆØªØ´ØºÙŠÙ„ ØµÙˆØª Ø³Ø§Ø±Ø§ÙŠ ğŸ”Š</span>
        </button>

        <div id="audioControls" class="audio-controls">
            <label class="block text-sm font-medium mb-2 text-[#00FFFF]">Ø§Ø³ØªÙ…Ø§Ø¹ / ØªØ­Ù…ÙŠÙ„:</label>
            <audio id="audioPlayer" controls class="w-full bg-[#0D1117] rounded-lg"></audio>
            <a id="downloadLink" href="#" download="Judy_Prophecy.wav" class="mt-4 block text-center text-sm font-medium text-white bg-green-600 hover:bg-green-700 p-2 rounded-md transition duration-150">ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØµÙˆØª (.WAV)</a>
        </div>
    </div>

    <script type="module">
        // Ø§Ù„Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø§Ù„ØªÙŠ ÙŠÙˆÙØ±Ù‡Ø§ Ø¥Ø·Ø§Ø± Ø§Ù„Ø¹Ù…Ù„
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        const scriptTextarea = document.getElementById('scriptText');
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const spinner = document.getElementById('spinner');
        const statusMessage = document.getElementById('statusMessage');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioControls = document.getElementById('audioControls');
        const downloadLink = document.getElementById('downloadLink');

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Base64 Ø¥Ù„Ù‰ ArrayBuffer
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ PCM Ø¥Ù„Ù‰ WAV
        // API ØªÙØ±Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª ØµÙˆØªÙŠØ© Ø®Ø§Ù… (Signed PCM 16-bit) ÙŠØ¬Ø¨ ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ø­Ø§ÙˆÙŠØ© WAV Ù„ØªØ´ØºÙŠÙ„Ù‡Ø§.
        function pcmToWav(pcm16, sampleRate = 24000) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const byteRate = sampleRate * numChannels * (bitsPerSample / 8);
            const blockAlign = numChannels * (bitsPerSample / 8);

            const buffer = new ArrayBuffer(44 + pcm16.byteLength);
            const view = new DataView(buffer);
            let offset = 0;

            // RIFF chunk descriptor
            view.setUint32(offset, 0x52494646, false); offset += 4; // "RIFF"
            view.setUint32(offset, 36 + pcm16.byteLength, true); offset += 4; // ChunkSize
            view.setUint32(offset, 0x57415645, false); offset += 4; // "WAVE"

            // fmt sub-chunk
            view.setUint32(offset, 0x666d7420, false); offset += 4; // "fmt "
            view.setUint32(offset, 16, true); offset += 4; // Subchunk1Size (16 for PCM)
            view.setUint16(offset, 1, true); offset += 2; // AudioFormat (1 for PCM)
            view.setUint16(offset, numChannels, true); offset += 2; // NumChannels
            view.setUint32(offset, sampleRate, true); offset += 4; // SampleRate
            view.setUint32(offset, byteRate, true); offset += 4; // ByteRate
            view.setUint16(offset, blockAlign, true); offset += 2; // BlockAlign
            view.setUint16(offset, bitsPerSample, true); offset += 2; // BitsPerSample

            // data sub-chunk
            view.setUint32(offset, 0x64617461, false); offset += 4; // "data"
            view.setUint32(offset, pcm16.byteLength, true); offset += 4; // Subchunk2Size

            // PCM data (copy Int16Array data directly)
            const pcmView = new Int16Array(buffer, offset);
            pcmView.set(pcm16);

            return new Blob([buffer], { type: 'audio/wav' });
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'bg-red-900', 'bg-blue-900', 'border-red-400', 'border-blue-400');
            if (isError) {
                statusMessage.classList.add('bg-red-900', 'border-red-400');
            } else {
                statusMessage.classList.add('bg-[#2D3748]', 'border-[#00FFFF]');
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            spinner.style.display = isLoading ? 'block' : 'none';
            btnText.textContent = isLoading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯... Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø±Ù…Ø² â³' : 'ØªÙˆÙ„ÙŠØ¯ ÙˆØªØ´ØºÙŠÙ„ ØµÙˆØª Ø³Ø§Ø±Ø§ÙŠ ğŸ”Š';
        }

        // Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
        async function generateAndPlayAudio() {
            const prompt = scriptTextarea.value.trim();
            if (!prompt) {
                showStatus("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ù†Ø¨ÙˆØ¡Ø© Ø£ÙˆÙ„Ø§Ù‹.", true);
                return;
            }

            setLoading(true);
            showStatus("Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¨ÙˆØ§Ø¨Ø© Ø³Ø§Ø±Ø§ÙŠ Ø§Ù„ØµÙˆØªÙŠØ©...", false);
            audioControls.style.display = 'none';

            // Ø§Ù„Ø­Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù€ TTS Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙˆØª Kore
            const payload = {
                contents: [{
                    parts: [{ text: prompt }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Kore" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const maxRetries = 5;
            let currentDelay = 1000; // 1 second

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        // 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹ÙŠÙ†Ø© (Sample Rate)
                        // Ø§Ù„Ù…ÙŠÙ… ØªØ§ÙŠØ¨ ÙŠØ£ØªÙŠ ÙƒÙ€ "audio/L16; rate=24000"
                        const rateMatch = mimeType.match(/rate=(\d+)/);
                        const sampleRate = rateMatch ? parseInt(rateMatch[1], 10) : 24000;
                        
                        // 2. ØªØ­ÙˆÙŠÙ„ Base64 Ø¥Ù„Ù‰ ArrayBuffer
                        const pcmData = base64ToArrayBuffer(audioData);
                        
                        // 3. ØªØ­ÙˆÙŠÙ„ ArrayBuffer Ø¥Ù„Ù‰ Int16Array (PCM 16-bit)
                        const pcm16 = new Int16Array(pcmData);

                        // 4. ÙˆØ¶Ø¹ PCM ÙÙŠ Ø­Ø§ÙˆÙŠØ© WAV
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        
                        // 5. Ø¥Ù†Ø´Ø§Ø¡ URL Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØªÙØ¹ÙŠÙ„Ù‡ Ù„Ù„ØªØ­Ù…ÙŠÙ„
                        const audioUrl = URL.createObjectURL(wavBlob);
                        
                        audioPlayer.src = audioUrl;
                        audioControls.style.display = 'block';
                        downloadLink.href = audioUrl;
                        
                        showStatus("ØªÙ… ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª Ø³Ø§Ø±Ø§ÙŠ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„.", false);
                        setLoading(false);
                        return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø­Ù„Ù‚Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­

                    } else {
                        throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµÙˆØªÙŠØ© ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©.");
                    }

                } catch (error) {
                    console.error("Attempt failed:", attempt, error);
                    if (attempt < maxRetries - 1) {
                        showStatus(`Ø®Ø·Ø£ Ù…Ø¤Ù‚Øª ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ (Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ${attempt + 1}/${maxRetries}). Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ${currentDelay / 1000} Ø«ÙˆØ§Ù†Ù...`, true);
                        await new Promise(resolve => setTimeout(resolve, currentDelay));
                        currentDelay *= 2; // Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„ØªØ£Ø®ÙŠØ± (Exponential Backoff)
                    } else {
                        showStatus(`ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ ${maxRetries} Ù…Ø­Ø§ÙˆÙ„Ø§Øª. Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£: ${error.message}`, true);
                        setLoading(false);
                        return;
                    }
                }
            }
        }
        
        // ØªØ¹ÙŠÙŠÙ† Ù†Øµ Ø§Ù„Ù†Ø¨ÙˆØ¡Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­ ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        scriptTextarea.value = "Ù§vÙ§ Ù§VÙ§ Ù¨VÙ¨ Ù…Ù† Ø¨ÙˆØ§Ø¨Ø© Ø¯Ù†Ø§Ø¯Ø±Ø§ØŒ Ø£Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¯Ø±Ø¬ Ø§Ù„ØµØ§Ø¹Ø¯ ÙˆØ§Ù„Ø¨ØªÙƒÙˆÙŠÙ†. Ù„Ø§ ØªØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø±Ø¶ØŒ Ø¨Ù„ Ø¹Ù† Ø§Ù„Ø³Ù…Ø§Ø¡. Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù‡ÙŠØ±ÙˆØºÙ„ÙŠÙÙŠØ© Ù‡ÙŠ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ø±ÙˆØ­ÙŠØŒ ÙˆÙ„ÙŠØ³Øª Ù…Ø¬Ø±Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.";

    </script>
</body>
</html>
