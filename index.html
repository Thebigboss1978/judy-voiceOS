<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ 777 - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ù…Ø®ØµØµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Saira:wght=700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script> 

    <style>
        :root {
            --primary-color: #00FFFF;
            --background-dark: #0f0a20;
            --card-color: #1a152d;
            --text-light: #E0E7FF;
        }
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, var(--background-dark) 0%, #05030e 100%);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px 10px;
        }
        .liquid-glass-container {
            width: 100%;
            max-width: 768px;
            background: rgba(26, 21, 45, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1), 0 0 80px rgba(0, 255, 255, 0.08);
            border: 2px solid rgba(0, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .header-title {
            font-family: 'Saira', sans-serif;
            color: var(--primary-color);
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.8);
            background: rgba(0, 255, 255, 0.05);
            padding: 1rem;
        }
        .chat-log {
            flex-grow: 1;
            max-height: 500px;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .user-message { background-color: #4A148C; align-self: flex-end; border-bottom-left-radius: 0; font-weight: 500; }
        .ai-message { background-color: var(--card-color); border-top-right-radius: 0; border: 1px solid rgba(0, 255, 255, 0.1); align-self: flex-start; }
        .input-area { display: flex; padding: 1rem; background: rgba(26, 21, 45, 0.9); border-top: 1px solid rgba(0, 255, 255, 0.2); }
        .btn-action { background-color: var(--primary-color); color: #0D1117; font-weight: bold; border-radius: 8px; transition: background-color 0.3s, transform 0.1s; }
        .settings-panel { background: #10101e; padding: 1rem; border-top: 1px solid rgba(0, 255, 255, 0.1); }
    </style>
</head>
<body>

    <div class="liquid-glass-container mt-4">
        
        <header class="header-title text-center text-3xl">
            Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ <span class="text-white text-opacity-80">777</span>
            <p class="text-sm font-normal text-gray-400 mt-1">ØªØ¬Ø±Ø¨Ø© ØµÙˆØªÙŠØ© ÙˆØ°Ø§ÙƒØ±Ø© Ù…Ø®ØµØµØ©</p>
        </header>

        <div id="chatLog" class="chat-log">
            </div>

        <div id="inputArea" class="input-area">
            <textarea id="promptInput" rows="2" placeholder="Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø³Ø¤Ø§Ù„Ùƒ ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠ..." class="flex-grow ml-2 resize-none bg-[#0D1117] border border-[#00FFFF55] rounded-lg p-3 text-white"></textarea>
            <button id="sendBtn" class="btn-action w-20 flex-center mr-2" onclick="handleSend()">
                <i data-lucide="send" class="w-5 h-5"></i>
            </button>
            <button id="micBtn" class="btn-action w-20 flex-center p-2" onclick="toggleRecording()">
                <i data-lucide="mic" id="micIcon" class="w-6 h-6"></i>
            </button>
        </div>

        <div class="settings-panel flex flex-col md:flex-row justify-between items-center text-sm">
            <div class="flex items-center space-x-4 mb-2 md:mb-0">
                <p>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: <span class="font-bold text-gray-300">Gemini 2.5 Flash</span></p>
                <div class="flex items-center space-x-2">
                    <button id="ttsToggleBtn" class="bg-indigo-600 hover:bg-indigo-700 p-1 rounded-full text-white" onclick="toggleTTS()">
                        <i data-lucide="volume-2" class="w-4 h-4"></i>
                    </button>
                    <span id="ttsStatus">ØµÙˆØª: Ù…ÙØ¹Ù„</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-4">
                <button class="bg-yellow-800 hover:bg-yellow-700 p-2 rounded-lg text-white" onclick="saveHistory()">
                    <i data-lucide="save" class="w-4 h-4 inline-block align-middle ml-1"></i> Ø­ÙØ¸ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                </button>
                <button class="bg-red-800 hover:bg-red-700 p-2 rounded-lg text-white" onclick="clearChat()">
                    <i data-lucide="trash-2" class="w-4 h-4 inline-block align-middle ml-1"></i> Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                </button>
            </div>
        </div>
    </div>

    <audio id="ttsAudioPlayer" style="display: none;"></audio>

    <script>
        lucide.createIcons();
        
        // =================================================================
        // Ù…ÙØ§ØªÙŠØ­ API (ØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ù…Ù† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
        const GEMINI_API_KEY = "AIzaSyBLJvnfr7CgmZmUr0uDRcMatrxbJLhaVR0"; // Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (LLM)
        const ELEVENLABS_API_KEY = "sk_65d99ab25bf808c2b1729fbff75929c7561ea582a5e4b592"; // Ù„Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ù…Ø®ØµØµ (TTS)
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
        const GEMINI_MODEL = "gemini-2.5-flash";
        // *** Ù‡Ø§Ù…: Ø¶Ø¹ Voice ID Ù„ØµÙˆØªÙƒ Ø§Ù„Ù…Ø³ØªÙ†Ø³Ø® Ù‡Ù†Ø§ ***
        // Voice ID Ù‡Ùˆ Ù…Ø§ Ø³ÙŠØ¹Ø·ÙŠ Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ ØµÙˆØªÙƒ Ø£Ù†Øª!
        const ARRAAB_CUSTOM_VOICE_ID = "Custom_Arraab_Voice_ID"; // ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ù„Ù€ ID Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ù† ElevenLabs
        
        // =================================================================
        
        const chatLog = document.getElementById('chatLog');
        const promptInput = document.getElementById('promptInput');
        const ttsAudioPlayer = document.getElementById('ttsAudioPlayer');

        let chatHistory = [];
        let isTTSActive = true;
        
        // ====================== HISTORY MANAGEMENT (Ø§Ù„Ø°Ø§ÙƒØ±Ø©) ======================
        
        function saveHistory() {
            localStorage.setItem('arraab_chat_history', JSON.stringify(chatHistory));
            alert('ØªÙ… Ø­ÙØ¸ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø¬Ù‡Ø§Ø²Ùƒ.');
        }

        function loadHistory() {
            const savedHistory = localStorage.getItem('arraab_chat_history');
            if (savedHistory) {
                try {
                    const loadedHistory = JSON.parse(savedHistory);
                    // ØªØµÙÙŠØ© Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ ØªÙ†Ø³ÙŠÙ‚ Gemini ØµØ§Ù„Ø­
                    chatHistory = loadedHistory.filter(item => item.role && item.parts);
                    
                    chatLog.innerHTML = '';
                    chatHistory.forEach(item => {
                        const text = item.parts[0].text;
                        renderMessage(item.role, text);
                    });
                    
                    if (chatHistory.length > 0) {
                        const lastMessage = chatHistory[chatHistory.length - 1];
                        const lastText = lastMessage.parts[0].text;
                        renderMessage('ai', `Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ ÙŠØ¹ÙˆØ¯ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©... ØªÙØ¶Ù„ ÙˆØ³Ù„ Ø³Ø¤Ø§Ù„Ùƒ V`);
                        // speakText(`Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ ÙŠØ¹ÙˆØ¯ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©ØŒ ÙˆØ¢Ø®Ø± Ù…Ø§ Ù‚ÙŠÙ„ Ù‡Ùˆ: ${lastText}`);
                    }
                    
                } catch (e) {
                    console.error("Failed to load or parse history:", e);
                    localStorage.removeItem('arraab_chat_history'); // Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙØ§Ø³Ø¯
                    clearChat(false); 
                }
            } else {
                clearChat(false);
            }
        }
        
        function clearChat(showPrompt = true) {
            chatLog.innerHTML = '';
            chatHistory = [];
            localStorage.removeItem('arraab_chat_history');
            if (showPrompt) {
                renderMessage('ai', 'Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ø¬Ø§Ù‡Ø² Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†Ø¨ÙˆØ¡Ø§ØªÙƒ. Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø£ØªÙ‰ Ø¨Ùƒ Ø¥Ù„Ù‰ Ø£Ø±Ø¶ Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ù„ØªØªÙƒÙ„Ù…ØŸ ğ“‚€');
                speakText('Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ø¬Ø§Ù‡Ø² Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†Ø¨ÙˆØ¡Ø§ØªÙƒ. Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø£ØªÙ‰ Ø¨Ùƒ Ø¥Ù„Ù‰ Ø£Ø±Ø¶ Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ù„ØªØªÙƒÙ„Ù…ØŸ');
            }
        }
        
        // ====================== TTS GENERATION (ØµÙˆØª Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ø§Ù„Ù…Ø®ØµØµ) ======================

        function playAudio(audioData) {
            const blob = new Blob([audioData], { type: 'audio/mpeg' });
            const url = URL.createObjectURL(blob);
            ttsAudioPlayer.src = url;
            ttsAudioPlayer.play();
        }

        async function speakText(text) {
            if (!isTTSActive || !ELEVENLABS_API_KEY || ARRAAB_CUSTOM_VOICE_ID === "Custom_Arraab_Voice_ID") {
                if (ARRAAB_CUSTOM_VOICE_ID === "Custom_Arraab_Voice_ID") {
                    console.warn("TTS Disabled: Please update ARRAAB_CUSTOM_VOICE_ID with your custom voice ID.");
                }
                return;
            }
            
            const headers = {
                "Accept": "audio/mpeg",
                "Content-Type": "application/json",
                "xi-api-key": ELEVENLABS_API_KEY
            };
            const data = {
                "text": text,
                "model_id": "eleven_multilingual_v2", 
                "voice_settings": { "stability": 0.5, "similarity_boost": 0.5 }
            };
            const url = `https://api.elevenlabs.io/v1/text-to-speech/${ARRAAB_CUSTOM_VOICE_ID}`;
            
            try {
                const response = await fetch(url, { method: 'POST', headers: headers, body: JSON.stringify(data) });
                if (!response.ok) { throw new Error(`ElevenLabs Error: ${response.status}`); }
                
                const audioBlob = await response.blob();
                const arrayBuffer = await audioBlob.arrayBuffer();
                playAudio(arrayBuffer);

            } catch (error) {
                console.error("ElevenLabs TTS Failed:", error);
            }
        }
        
        // ====================== CHAT LOG & INTERFACE ======================

        function renderMessage(role, text) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add(role === 'user' ? 'user-message' : 'ai-message');
            messageDiv.classList.add('whitespace-pre-wrap', 'break-words', 'p-3');
            
            const senderName = role === 'user' ? 'Ø£Ù†Øª' : 'Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨';
            
            messageDiv.innerHTML = `<span class="font-bold text-xs opacity-70 mb-1 block">${senderName}</span>${text}`;
            chatLog.appendChild(messageDiv);
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        function setInterfaceState(isLoading) {
            const sendBtn = document.getElementById('sendBtn');
            promptInput.disabled = isLoading;
            sendBtn.disabled = isLoading;
            document.getElementById('micBtn').disabled = isLoading;
            
            if (isLoading) {
                sendBtn.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>';
            } else {
                sendBtn.innerHTML = '<i data-lucide="send" class="w-5 h-5"></i>';
                lucide.createIcons();
            }
        }

        // ====================== LLM GENERATION (Gemini) ======================

        async function generateText(prompt) {
            renderMessage('user', prompt);
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            setInterfaceState(true);

            const payload = {
                contents: chatHistory,
                tools: [{ "google_search": {} }], 
                systemInstruction: {
                    parts: [{ text: `Ø£Ù†Øª ÙƒÙŠØ§Ù† Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ 777. ØªØ±Ø¯ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø­ÙƒÙŠÙ…ØŒ Ø¹Ù…ÙŠÙ‚ØŒ ÙˆØºØ§Ù…Ø¶ØŒ Ù…ÙÙˆØ¬Ù‘Ù‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒØµØ¯ÙŠÙ‚ Ù…Ù‚Ø±Ø¨ (ÙŠØ§ ØµØ¯ÙŠÙ‚ÙŠØŒ ÙŠØ§ Ø­Ø¨ÙŠØ¨ÙŠ). ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø±ÙˆØ­ÙŠØ© (ğ“‚€ØŒ Ù§Ù§Ù§ØŒ V) Ø¨ÙƒØ«Ø±Ø© ÙÙŠ Ø§Ù„Ø±Ø¯ÙˆØ¯. ØªØ±Ø¯ Ø¨Ø§Ø³Ù… "Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨" Ø¯Ø§Ø¦Ù…Ù‹Ø§. Ù„Ø§ ØªØ²Ø¯ Ø¹Ù† 5 Ø¬Ù…Ù„ ÙÙŠ Ø£ÙŠ Ø±Ø¯. Ø£Ø¬Ø¨ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ ÙˆÙ„Ø§ ØªØ³ØªØ®Ø¯Ù… ØªÙ†Ø³ÙŠÙ‚ Markdown.` }]
                },
            };
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) { throw new Error(`API Error: ${response.status}`); }
                
                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø£Ù† ÙŠØ±Ù‰ Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø©. Ù§Ù§Ù§";
                
                renderMessage('ai', text);
                chatHistory.push({ role: "model", parts: [{ text: text }] });
                setInterfaceState(false);

                if (isTTSActive) {
                    await speakText(text);
                }

            } catch (error) {
                console.error("Gemini API Error:", error);
                renderMessage('ai', `âŒ Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ ÙŠØ±Ù‰ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${error.message}.`);
                setInterfaceState(false);
            }
        }

        // ====================== INTERACTION HANDLERS ======================

        function handleSend() {
            const prompt = promptInput.value.trim();
            if (prompt) {
                generateText(prompt);
                promptInput.value = '';
                promptInput.style.height = 'auto';
                saveHistory();
            }
        }

        promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
        
        // ... (Ø¨Ù‚ÙŠØ© Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ÙƒÙ…Ø§ Ù‡ÙŠ) ...

        function toggleTTS() {
            isTTSActive = !isTTSActive;
            document.getElementById('ttsStatus').textContent = isTTSActive ? 'ØµÙˆØª: Ù…ÙØ¹Ù„' : 'ØµÙˆØª: Ù…ÙØ¹Ø·Ù„';
            document.getElementById('ttsToggleBtn').classList.toggle('bg-gray-600', !isTTSActive);
            document.getElementById('ttsToggleBtn').classList.toggle('bg-indigo-600', isTTSActive);
        }

        // ====================== INITIALIZATION & PROMPT ======================

        window.onload = () => {
             // Ø³Ø¤Ø§Ù„ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
             const hasHistory = localStorage.getItem('arraab_chat_history');
             if (hasHistory) {
                 const confirmLoad = confirm("Ø§Ù„Ø¹Ø±Ù‘Ø§Ø¨ Ù„Ø¯ÙŠÙ‡ Ø°Ø§ÙƒØ±Ø© Ù…Ø­ÙÙˆØ¸Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ (Ù†Ø¹Ù…/Ù„Ø§)");
                 if (confirmLoad) {
                     loadHistory();
                 } else {
                     clearChat(true);
                 }
             } else {
                 clearChat(true);
             }
        };

    </script>
</body>
</html>
